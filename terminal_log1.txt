(orion_ct) andersonc@nitro:~/workspace/github/clnn$ /home/andersonc/anaconda3/envs/orion_ct/bin/python /home/andersonc/workspace/github/clnn/run_humob.py
ğŸ¯ HUMOB CHALLENGE - PIPELINE CORRIGIDO
==================================================
CorreÃ§Ãµes implementadas:
âœ… SequÃªncias temporais adequadas (LSTM funcional)
âœ… Dados normalizados [0,1] / [-1,1]
âœ… Rollout para mÃºltiplos passos
âœ… DiscretizaÃ§Ã£o para grid [0,199]
âœ… Pipeline completo treino â†’ submissÃ£o

ğŸ“ Arquivo encontrado: humob_all_cities_v2_normalized.parquet

Escolha uma opÃ§Ã£o:
1. ğŸ§ª Teste rÃ¡pido (verifica se tudo estÃ¡ funcionando)
2. ğŸƒ Exemplo mÃ­nimo (pipeline pequeno para demonstraÃ§Ã£o)
3. ğŸ† Pipeline completo (para submissÃ£o final)

Digite sua escolha (1-3): 2
ğŸš€ EXEMPLO MÃNIMO HUMOB
Device: cuda
========================================
ğŸ§ª TESTE RÃPIDO DO PIPELINE
========================================
1. Testando cÃ¡lculo de cluster centers...
ğŸ“‚ Carregando centros existentes: test_centers.npy
   âœ… Centers: torch.Size([64, 2])
2. Testando dataset...
   âœ… Batch shape: torch.Size([16, 6, 2])
   âœ… Ranges: d_norm=[0.041,0.622], coords=[0.342,0.668]
3. Testando modelo...
   âœ… PrediÃ§Ã£o shape: torch.Size([2, 2])
   âœ… PrediÃ§Ã£o range: [0.439, 0.586]

ğŸ‰ TESTE RÃPIDO PASSOU! Pipeline estÃ¡ funcionando.

ğŸƒ Executando pipeline mÃ­nimo...
ğŸš€ PIPELINE COMPLETO HUMOB CHALLENGE
Device: cuda
Clusters: 128
Epochs: 2
Sequence length: 8
============================================================

ğŸ“ ETAPA 1: Calculando cluster centers...
ğŸ“‚ Carregando centros existentes: centers_A_128.npy
âœ… Centers prontos: torch.Size([128, 2])

ğŸ‹ ETAPA 2: Treinando modelo na cidade A...
ğŸ‹ Iniciando treinamento do modelo HuMob...
ParÃ¢metros treinÃ¡veis: 469,574

ğŸ”„ Ã‰poca 1/2
Treino ['A']: 157229it [10:13:48,  4.27it/s, Loss=0.0012, GradNorm=0.02, LR=0.002000]
Val: 72403it [2:42:49,  7.41it/s, Val Loss=0.0009]
Treino: 0.0046 | Val: 0.0044
Fusion weights: w_r=-0.019, w_e=0.879
ğŸ’¾ Novo melhor modelo! Loss: 0.0044

ğŸ”„ Ã‰poca 2/2
Treino ['A']: 157229it [10:19:47,  4.23it/s, Loss=0.0015, GradNorm=0.02, LR=0.002000]
Val: 72403it [2:35:49,  7.74it/s, Val Loss=0.0014]
Treino: 0.0043 | Val: 0.0042
Fusion weights: w_r=0.023, w_e=0.741
ğŸ’¾ Novo melhor modelo! Loss: 0.0042

âœ… Treinamento concluÃ­do! Modelo salvo em: humob_model_A.pt
Melhor loss de validaÃ§Ã£o: 0.0042

ğŸ¯ ETAPA 3: AvaliaÃ§Ã£o zero-shot em B, C, D...

--- Avaliando cidade B ---
ğŸ¯ Avaliando modelo em cidades ['B']...
âŒ Erro avaliando cidade B: Weights only load failed. This file can still be loaded, to do so you have two options, do those steps only if you trust the source of the checkpoint.
        (1) In PyTorch 2.6, we changed the default value of the `weights_only` argument in `torch.load` from `False` to `True`. Re-running `torch.load` with `weights_only` set to `False` will likely succeed, but it can result in arbitrary code execution. Do it only if you got the file from a trusted source.
        (2) Alternatively, to load with `weights_only=True` please check the recommended steps in the following error message.
        WeightsUnpickler error: Unsupported global: GLOBAL numpy._core.multiarray._reconstruct was not an allowed global by default. Please use `torch.serialization.add_safe_globals([numpy._core.multiarray._reconstruct])` or the `torch.serialization.safe_globals([numpy._core.multiarray._reconstruct])` context manager to allowlist this global if you trust this class/function.

Check the documentation of torch.load to learn more about types accepted by default with weights_only https://pytorch.org/docs/stable/generated/torch.load.html.

--- Avaliando cidade C ---
ğŸ¯ Avaliando modelo em cidades ['C']...
âŒ Erro avaliando cidade C: Weights only load failed. This file can still be loaded, to do so you have two options, do those steps only if you trust the source of the checkpoint.
        (1) In PyTorch 2.6, we changed the default value of the `weights_only` argument in `torch.load` from `False` to `True`. Re-running `torch.load` with `weights_only` set to `False` will likely succeed, but it can result in arbitrary code execution. Do it only if you got the file from a trusted source.
        (2) Alternatively, to load with `weights_only=True` please check the recommended steps in the following error message.
        WeightsUnpickler error: Unsupported global: GLOBAL numpy._core.multiarray._reconstruct was not an allowed global by default. Please use `torch.serialization.add_safe_globals([numpy._core.multiarray._reconstruct])` or the `torch.serialization.safe_globals([numpy._core.multiarray._reconstruct])` context manager to allowlist this global if you trust this class/function.

Check the documentation of torch.load to learn more about types accepted by default with weights_only https://pytorch.org/docs/stable/generated/torch.load.html.

--- Avaliando cidade D ---
ğŸ¯ Avaliando modelo em cidades ['D']...
âŒ Erro avaliando cidade D: Weights only load failed. This file can still be loaded, to do so you have two options, do those steps only if you trust the source of the checkpoint.
        (1) In PyTorch 2.6, we changed the default value of the `weights_only` argument in `torch.load` from `False` to `True`. Re-running `torch.load` with `weights_only` set to `False` will likely succeed, but it can result in arbitrary code execution. Do it only if you got the file from a trusted source.
        (2) Alternatively, to load with `weights_only=True` please check the recommended steps in the following error message.
        WeightsUnpickler error: Unsupported global: GLOBAL numpy._core.multiarray._reconstruct was not an allowed global by default. Please use `torch.serialization.add_safe_globals([numpy._core.multiarray._reconstruct])` or the `torch.serialization.safe_globals([numpy._core.multiarray._reconstruct])` context manager to allowlist this global if you trust this class/function.

Check the documentation of torch.load to learn more about types accepted by default with weights_only https://pytorch.org/docs/stable/generated/torch.load.html.

ğŸ“Š ETAPA 4: Gerando plots...

ğŸ“‹ RELATÃ“RIO FINAL
============================================================
âœ… Treinamento concluÃ­do em 2 Ã©pocas
ğŸ“ˆ Loss final de treino: 0.0043
ğŸ“‰ Loss final de validaÃ§Ã£o: 0.0042
âš– Pesos da fusÃ£o: w_r=0.023, w_e=0.741

ğŸ¯ Resultados Zero-shot:
  Cidade B: MSE=inf, Erro cÃ©lulas=inf
  Cidade C: MSE=inf, Erro cÃ©lulas=inf
  Cidade D: MSE=inf, Erro cÃ©lulas=inf

ğŸ’¾ Arquivos gerados:
   - centers_A_128.npy (cluster centers)
   - humob_model_A.pt (modelo treinado)
   - humob_results.png (grÃ¡ficos)

ğŸ” VERIFICAÃ‡Ã•ES:
  Convergiu? âŒ (loss diminuiu 20%+)
  MSE razoÃ¡vel? âŒ (< 0.1 para [0,1])

âš  ALGUNS PROBLEMAS DETECTADOS
   Considere ajustar hiperparÃ¢metros ou verificar dados

ğŸ“„ Gerando submissÃ£o de exemplo...
ğŸ“„ Gerando submissÃ£o HuMob para cidades ['D']
Dias: 61-62 | Output: humob_example_submission.csv
âš  Erro na submissÃ£o: Weights only load failed. This file can still be loaded, to do so you have two options, do those steps only if you trust the source of the checkpoint.
        (1) In PyTorch 2.6, we changed the default value of the `weights_only` argument in `torch.load` from `False` to `True`. Re-running `torch.load` with `weights_only` set to `False` will likely succeed, but it can result in arbitrary code execution. Do it only if you got the file from a trusted source.
        (2) Alternatively, to load with `weights_only=True` please check the recommended steps in the following error message.
        WeightsUnpickler error: Unsupported global: GLOBAL numpy._core.multiarray._reconstruct was not an allowed global by default. Please use `torch.serialization.add_safe_globals([numpy._core.multiarray._reconstruct])` or the `torch.serialization.safe_globals([numpy._core.multiarray._reconstruct])` context manager to allowlist this global if you trust this class/function.

Check the documentation of torch.load to learn more about types accepted by default with weights_only https://pytorch.org/docs/stable/generated/torch.load.html.

